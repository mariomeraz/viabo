import{t as w,a as q,g as z,b as F,L as H,_ as B,P as R,p as K,w as U,x as k}from"./index-DkbAsBWZ.js";import{i as t,M as W,E as $,bl as Y,aH as p,aq as g,aI as E,aJ as j,r as n,e as Q,U as J,P as h,B as y,x as G,A as X,b0 as Z,aL as v,b1 as m,T as u,S as x,aK as aa,aM as sa}from"./vendor-5lkxkETF.js";import{f as L}from"./formatNumber-dGNhWwxT.js";import{n as b}from"./formatTime-jCgU2sMR.js";import{g as ra}from"./cardTypes-DiZXL2sx.js";import{C as ia}from"./CardMovementsHeader-DQjsUqAT.js";import{M as ta}from"./MaterialDataTable-Dl1JQ_sM.js";import{u as ea}from"./useMaterialTable-8QQmzXWd.js";import{C as la,H as ca}from"./HeaderPage-Bqn_U64p.js";const da={openDrawerLiquidateMovement:!1,movement:null,filterDate:null},na=(i,s)=>({...da,setMovementToLiquidate:a=>{i(e=>({movement:a}),!1,"SET_DETAILS_MOVEMENT_TO_LIQUIDATE")},setOpenDrawerLiquidateMovement:a=>{i(e=>({openDrawerLiquidateMovement:a}),!1,"SET_OPEN_LIQUIDATE_MOVEMENT_VIABO_PAY")},setFilterDate:a=>{i(e=>({filterDate:a}),!1,"SET_FILTER_DATE_LIQUIDATE_MOVEMENTS")}}),T=w(na);function oa(i){const{row:s,closeMenu:a}=i,{original:e}=s,{liquidationStatus:r}=e,{setMovementToLiquidate:l,setOpenDrawerLiquidateMovement:o}=T(c=>c);return[(r==null?void 0:r.id)!=="13"&&t.jsxs(W,{onClick:()=>{l(e),o(!0),a()},sx:{m:0},children:[t.jsx($,{children:t.jsx(Y,{color:"success"})}),"Liquidar"]},0)]}const ua={MOVEMENTS:"liquidated-viabo-pay-movements"},pa=i=>(i==null?void 0:i.map(a=>{const e=parseFloat((a==null?void 0:a.amount)||"0"),r=a!=null&&a.transaction_date?p(b(a==null?void 0:a.transaction_date),"dd MMM yyyy",{locale:g}):"",l=a!=null&&a.transaction_date?p(b(a==null?void 0:a.transaction_date),"p"):"";return{id:a==null?void 0:a.id,terminalName:a==null?void 0:a.terminal_name,terminalId:a==null?void 0:a.terminal_id,amount:e,amountFormat:L(e),amountToLiquidate:a==null?void 0:a.amountToSettled,amountToLiquidateFormat:L(a==null?void 0:a.amountToSettled),commerceName:a==null?void 0:a.commerceName,commerceId:a==null?void 0:a.commerceId,approved:a==null?void 0:a.approved,cardType:a==null?void 0:a.card_brand,authNumber:a==null?void 0:a.authorization_number,commission:(a==null?void 0:a.commission)>=0?`${a==null?void 0:a.commission}%`:"0%",cardNumber:a==null?void 0:a.card_number,cardBank:a==null?void 0:a.issuer,transactionDate:{fullDate:p(b(a==null?void 0:a.transaction_date),"dd MMM yyyy HH:mm",{locale:g}),date:r,time:l},serverDate:b(a==null?void 0:a.transaction_date),description:`${(a==null?void 0:a.issuer)===""?a==null?void 0:a.card_brand:a==null?void 0:a.issuer}-${a==null?void 0:a.card_number}`.toUpperCase(),transactionMessage:a==null?void 0:a.result_message,conciliated:!!(a!=null&&a.conciliated),conciliatedName:a!=null&&a.conciliated?"Conciliada":"Sin Conciliar",liquidationStatus:{id:a==null?void 0:a.liquidationStatusId,name:a==null?void 0:a.liquidationStatusName},dataToLiquidate:{id:a==null?void 0:a.id,commerceId:a==null?void 0:a.commerceId,authorization_number:a==null?void 0:a.authorization_number,terminal_id:a==null?void 0:a.terminal_id,terminal_spei_card:(a==null?void 0:a.terminal_spei_card)||"",amountToSettled:a==null?void 0:a.amountToSettled}}}))??[],ha=async(i,s,a)=>{const e=new URL("/api/terminals/shared/transactions",window.location.origin);e.searchParams.set("startDate",i),e.searchParams.set("endDate",s);const{data:r}=await q.get(e.href,{signal:a});return pa(r)},Aa=async i=>{const{data:s}=await q.post("/api/card/transactions/shared-terminals",i);return s},ya=(i,s,a={})=>{if(!i||!s)return null;const{setFilterDate:e}=T(d=>d),r=p(E(i),"yyyy-MM-dd HH:mm:ss"),l=p(j(s),"yyyy-MM-dd HH:mm:ss"),[o,M]=n.useState(null),c=Q({queryKey:[ua.MOVEMENTS],queryFn:({signal:d})=>ha(r,l,d),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,onSuccess:d=>{e({startDate:E(i),endDate:j(s),text:`${p(i,"dd MMMM yyyy",{locale:g})} - ${p(s,"dd MMMM yyyy",{locale:g})}`})},...a});return n.useEffect(()=>{if(c!=null&&c.isError){const d=z(c.error,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");M(d),J.error(d,{type:F(c.error)})}},[c.isError,c.error]),{...c,error:o||null}},A=({row:i})=>{const{original:s}=i,a=s==null?void 0:s.approved,e=ra(s==null?void 0:s.cardType),r=e==null?void 0:e.component;return t.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[t.jsxs(y,{sx:{position:"relative"},children:[t.jsx(G,{title:s==null?void 0:s.cardType,children:t.jsx(X,{sx:{width:40,height:40,color:"text.secondary",bgcolor:"background.neutral"},children:e?t.jsx(r,{sx:{width:25,height:25}}):t.jsx(Z,{width:25,height:25})})}),t.jsx(y,{sx:{right:0,bottom:0,width:15,height:15,display:"flex",borderRadius:"50%",position:"absolute",alignItems:"center",color:"common.white",bgcolor:"error.main",justifyContent:"center",...a&&{bgcolor:"success.main"}},children:a?t.jsx(v,{sx:{width:12,height:12}}):t.jsx(m,{sx:{width:12,height:12}})})]}),t.jsxs(y,{sx:{ml:2},children:[t.jsx(u,{variant:"subtitle2",sx:{textWrap:"wrap"},children:s==null?void 0:s.description}),t.jsx(u,{variant:"body2",textTransform:"capitalize",sx:{color:a?"success.main":"error.main",textWrap:"wrap"},children:s==null?void 0:s.transactionMessage})]})]})};A.propTypes={row:h.shape({original:h.shape({approved:h.bool,cardType:h.any,description:h.any,transactionMessage:h.any})})};const Ma=()=>n.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({row:i})=>t.jsx(A,{row:i})},{accessorKey:"terminalName",header:"Terminal",size:120,Cell:({cell:i,column:s,row:a,renderedCellValue:e})=>{const{original:r}=a;return t.jsx(u,{fontWeight:"bold",variant:"subtitle2",children:r==null?void 0:r.terminalName})}},{accessorKey:"commerceName",header:"Comercio",size:120},{accessorKey:"serverDate",header:"Fecha",size:100,Cell:({cell:i,column:s,row:a,renderedCellValue:e})=>{var l;const{original:r}=a;return t.jsx(x,{children:t.jsx(u,{variant:"subtitle2",children:(l=r==null?void 0:r.transactionDate)==null?void 0:l.fullDate})})}},{accessorKey:"amount",header:"Monto Cobrado",size:120,Cell:({cell:i,column:s,row:a,renderedCellValue:e})=>{const{original:r}=a;return t.jsx(x,{children:t.jsx(u,{fontWeight:"bold",variant:"subtitle2",children:r==null?void 0:r.amountFormat})})}},{accessorKey:"amountToLiquidate",header:"Monto por liquidar",size:120,Cell:({cell:i,column:s,row:a,renderedCellValue:e})=>{const{original:r}=a;return t.jsx(x,{children:t.jsx(u,{fontWeight:"bold",color:"success.main",variant:"subtitle2",children:r==null?void 0:r.amountToLiquidateFormat})})}},{id:"status",accessorFn:i=>{var s;return((s=i==null?void 0:i.liquidationStatus)==null?void 0:s.name)||null},header:"Estado de LiquidaciÃ³n",size:120,Cell:({cell:i,column:s,row:a,renderedCellValue:e})=>{var l;const{original:r}=a;return t.jsx(x,{children:t.jsx(u,{variant:"subtitle2",children:(l=r==null?void 0:r.liquidationStatus)==null?void 0:l.name})})}}],[]),xa=()=>{const i=new Date,s=T(_=>_.filterDate),a=n.useMemo(()=>s!=null&&s.startDate?new Date(s==null?void 0:s.startDate):aa(i,{days:30}),[s==null?void 0:s.startDate]),e=n.useMemo(()=>s!=null&&s.endDate?new Date(s==null?void 0:s.endDate):i,[s==null?void 0:s.endDate]),[r,l]=n.useState(a),[o,M]=n.useState(e),{data:c,isError:d,error:I,isLoading:P,isFetching:C,refetch:D}=ya(r,o);n.useEffect(()=>{r&&o&&D()},[r,o]);const O=Ma(),V=ea(d,I,{columns:O,data:c||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:P,showAlertBanner:d,showProgressBars:C},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderRowActionMenuItems:oa,renderTopToolbarCustomActions:()=>t.jsx(y,{})}),N=_=>{const{startDate:f,endDate:S}=_;S!==null&&f!==null&&(M(S),l(f))};return t.jsxs(sa,{children:[t.jsx(ia,{startDate:r,endDate:o,onChangeDateRange:N,hideBalance:!0,loading:C}),t.jsx(ta,{table:V})]})},ba=H(n.lazy(()=>B(()=>import("./LiquidateTerminalMovementDrawer-6xsjqEIF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])))),ga=()=>t.jsx(R,{title:"Movimientos a Liquidar Viabo Pay",children:t.jsxs(la,{children:[t.jsx(ca,{name:"Nube",links:[{name:"Inicio",href:K.root},{name:"Viabo Pay",href:U.cloud},{name:k.cloud.name}]}),t.jsx(xa,{}),t.jsx(ba,{})]})}),Ia=Object.freeze(Object.defineProperty({__proto__:null,default:ga},Symbol.toStringTag,{value:"Module"}));export{ua as C,Ia as a,Aa as l,T as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/LiquidateTerminalMovementDrawer-6xsjqEIF.js","assets/js/index-DkbAsBWZ.js","assets/js/vendor-5lkxkETF.js","assets/css/build-Bl0dWaDY.css","assets/js/RightPanel-DRwW1nHJ.js","assets/js/formatNumber-dGNhWwxT.js","assets/js/formatTime-jCgU2sMR.js","assets/js/cardTypes-DiZXL2sx.js","assets/js/AmexLogo-BNm7u8Au.js","assets/js/CarnetLogo-CFGRKXQt.js","assets/js/MasterCardLogo-C26mw1FM.js","assets/js/VisaLogo-BXtVVQaT.js","assets/js/CardMovementsHeader-DQjsUqAT.js","assets/js/MaterialDataTable-Dl1JQ_sM.js","assets/js/useMaterialTable-8QQmzXWd.js","assets/js/HeaderPage-Bqn_U64p.js","assets/js/fade-CViozI82.js","assets/js/transition-anLY3gj9.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=CloudMovementsPay-Dchv009A.js.map
