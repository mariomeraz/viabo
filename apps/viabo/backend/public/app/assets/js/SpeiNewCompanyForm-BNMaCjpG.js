import{c as Q,f as X,U as M,u as y,i as e,S as t,T as o,B as I,b4 as ee,dN as re,e6 as se,e1 as k,e7 as W,aT as C,dj as ie,dn as ae,Q as te,P as a}from"./vendor-5lkxkETF.js";import{u as le}from"./formik.esm-CTTSENmf.js";import{b as $,c as B,a as j,d as F,f as ne}from"./index.esm-gIIytEq8.js";import{g as Y,b as G,Z as de}from"./index-DkbAsBWZ.js";import{M as E,n as oe,S as U,d as ue}from"./ViaboSpeiCompanies-Op27a9om.js";import{i as T}from"./matchTypes-mENztEWg.js";import{V as me}from"./viabo-card-CcTpX9JZ.js";import{F as he,R as x,a as ce}from"./TextMaxLine-B63DtfW-.js";import{R as z}from"./RFSelect-DSsw7uR8.js";import"./useViaboSpeiBreadCrumbs-DFn8fp3c.js";import"./viabo-spei-paths-CvU5WLsk.js";import"./formatNumber-dGNhWwxT.js";import"./MaterialDataTable-Dl1JQ_sM.js";import"./ModalAlert-Ju1kumTl.js";import"./useMaterialTable-8QQmzXWd.js";import"./HeaderPage-Bqn_U64p.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./formatTime-jCgU2sMR.js";import"./UploadSingleFile-ByYCreVQ.js";const xe=r=>{var c,u,s,m,f,p,b,N,l,d;return{fiscalName:(c=r==null?void 0:r.fiscalName)==null?void 0:c.trim(),rfc:(u=r==null?void 0:r.rfc)==null?void 0:u.trim(),commercialName:(s=r==null?void 0:r.commercialName)==null?void 0:s.trim(),stpAccount:(m=r==null?void 0:r.concentrator)==null?void 0:m.value,isNewUser:(r==null?void 0:r.method)===E.NEW_ADMIN_USER,assignedUsers:((f=r==null?void 0:r.adminUsers)==null?void 0:f.map(v=>v.value))||[],userName:(p=r==null?void 0:r.adminName)==null?void 0:p.trim(),userLastName:(b=r==null?void 0:r.adminLastName)==null?void 0:b.trim(),userEmail:(N=r==null?void 0:r.adminEmail)==null?void 0:N.trim(),userPhone:(l=r==null?void 0:r.adminPhone)==null?void 0:l.trim(),costCenters:((d=r==null?void 0:r.costCenters)==null?void 0:d.map(v=>v.value))||[],hasViaboCard:r==null?void 0:r.hasViaboCard,commissions:{speiOut:r==null?void 0:r.speiOut,speiIn:r==null?void 0:r.speiIn,internal:r==null?void 0:r.internalTransferCompany,feeStp:r==null?void 0:r.fee}}},pe=(r={})=>{const c=Q(),u=X(oe,r);return{...u,mutate:async(m,f)=>{const{onSuccess:p,onError:b,mutationOptions:N}=f;try{await M.promise(u.mutateAsync(m,N),{pending:"Creando empresa...",success:{render({data:l}){return c.invalidateQueries([U.COMPANIES_LIST]),T(p)&&p(l),"Se creó la empresa con éxito"}}})}catch(l){const d=Y(l,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");T(b)&&b(d),M.error(d,{type:G(l)})}}}},be=(r={})=>{const c=Q(),u=X(ue,r);return{...u,mutate:async(m,f)=>{const{onSuccess:p,onError:b,mutationOptions:N}=f;try{await M.promise(u.mutateAsync(m,N),{pending:"Actualizando empresa...",success:{render({data:l}){return c.invalidateQueries([U.COMPANIES_LIST]),c.invalidateQueries([U.COMPANY_DETAILS,l==null?void 0:l.id]),T(p)&&p(l),"Se actualizó la empresa con éxito"}}})}catch(l){const d=Y(l,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");T(b)&&b(d),M.error(d,{type:G(l)})}}}},A=0,P=.1,je=({adminCompanyUsers:r,costCenters:c,concentrators:u,company:s,commissions:m,onSuccess:f})=>{var R,q,L,V;const{mutate:p,isLoading:b}=pe(),{mutate:N,isLoading:l}=be(),d=(m==null?void 0:m.percentage)||15,v=(m==null?void 0:m.amount)||20,_=$().min(A,"El valor mínimo es 0").max(d,`El valor máximo es ${d}`).required("El valor es requerido"),H=$().min(A,"El valor mínimo es 0").max(v,`El valor máximo es ${v}`).required("El valor es requerido"),K=B().shape({fiscalName:j().trim().required("Es necesario el nombre fiscal"),rfc:j().trim().required("Es necesario el rfc"),commercialName:j().trim().max(100,"Máximo 100 caracteres"),concentrator:B().nullable().required("Es necesario la concentradora"),adminUsers:F().when("method",{is:E.ADMIN_USERS,then:i=>i.min(1,"Es necesario al menos un usuario administrador asignado a la empresa"),otherwise:i=>F()}),adminName:j().trim().when("method",{is:E.NEW_ADMIN_USER,then:i=>i.required("Es necesario el nombre del administrador"),otherwise:i=>j().trim()}),adminLastName:j().trim().when("method",{is:E.NEW_ADMIN_USER,then:i=>i.required("Es necesario los apellidos del administrador"),otherwise:i=>j().trim()}),adminEmail:j().trim().email("Ingrese un correo valido").when("method",{is:E.NEW_ADMIN_USER,then:i=>i.required("Es necesario el correo del administrador"),otherwise:i=>j().trim().email("Ingrese un correo valido")}),adminPhone:j().trim(),hasViaboCard:ne(),costCenters:F(),speiOut:_,internalTransferCompany:_,fee:H,speiIn:_}),O=le({initialValues:{fiscalName:(s==null?void 0:s.fiscalName)||"",commercialName:(s==null?void 0:s.commercialName)||"",concentrator:(u==null?void 0:u.find(i=>{var h;return(i==null?void 0:i.value)===((h=s==null?void 0:s.concentrator)==null?void 0:h.id)}))||null,rfc:(s==null?void 0:s.rfc)||"",method:E.ADMIN_USERS,adminUsers:(r==null?void 0:r.filter(i=>{var h;return(h=s==null?void 0:s.adminUsers)==null?void 0:h.includes(i==null?void 0:i.value)}))||[],costCenters:(c==null?void 0:c.filter(i=>{var h;return(h=s==null?void 0:s.costCenters)==null?void 0:h.includes(i==null?void 0:i.value)}))||[],adminName:"",adminLastName:"",adminEmail:"",adminPhone:"",hasViaboCard:!1,speiOut:((R=s==null?void 0:s.commissions)==null?void 0:R.speiOut)||0,internalTransferCompany:((q=s==null?void 0:s.commissions)==null?void 0:q.internalTransferCompany)||0,fee:((L=s==null?void 0:s.commissions)==null?void 0:L.fee)||0,speiIn:((V=s==null?void 0:s.commissions)==null?void 0:V.speiIn)||0},enableReinitialize:!0,validationSchema:K,onSubmit:(i,{setSubmitting:h,setFieldValue:fe})=>{const D=xe(i);return s?N({...D,id:s==null?void 0:s.id},{onSuccess:()=>{f(),h(!1)},onError:()=>{h(!1)}}):p(D,{onSuccess:()=>{f(),h(!1)},onError:()=>{h(!1)}})}}),{isSubmitting:Z,setFieldValue:S,values:g,setTouched:J}=O,n=Z||b||l,w=y();return e.jsx(he,{formik:O,children:e.jsxs(t,{spacing:2,children:[e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre Fiscal",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(x,{required:!0,name:"fiscalName",size:"small",disabled:n,placeholder:"Nombre Fiscal de la Empresa..."})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["RFC",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),s?e.jsx(o,{variant:"subtitle1",children:g==null?void 0:g.rfc}):e.jsx(x,{required:!0,name:"rfc",size:"small",placeholder:"RFC de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre Comercial"}),e.jsx(x,{inputProps:{maxLength:"100"},name:"commercialName",size:"small",placeholder:"Nombre Comercial de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Concentradora STP"," ",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(z,{name:"concentrator",textFieldParams:{placeholder:"Seleccionar ...",size:"small",required:!0},options:u||[],disabled:n})]}),e.jsx(t,{children:e.jsxs(ee,{disabled:n,children:[e.jsx(re,{id:"demo-row-radio-buttons-group-label",children:"Seleccione al administrador de la empresa:"}),e.jsxs(se,{value:g.method,onChange:i=>{!s&&S("adminUsers",[]),S("adminName",""),S("adminLastName",""),S("adminEmail",""),S("adminPhone",""),S("method",i.target.value),J({},!1)},row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",children:[e.jsx(k,{value:E.ADMIN_USERS,control:e.jsx(W,{}),label:"Administrador de Empresa Existente"}),e.jsx(k,{value:E.NEW_ADMIN_USER,control:e.jsx(W,{}),label:"Nuevo Administrador de Empresa"})]})]})}),g.method===E.ADMIN_USERS?e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Usuarios Administradores",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(z,{multiple:!0,name:"adminUsers",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:r||[],disabled:n})]}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre (s)",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(x,{name:"adminName",size:"small",required:!0,placeholder:"Nombre Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Apellido (s)",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(x,{name:"adminLastName",size:"small",required:!0,placeholder:"Apellidos del Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{flexDirection:{md:"row"},gap:2,children:[e.jsxs(t,{spacing:1,flex:1,children:[e.jsxs(o,{type:"email",paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Correo",e.jsx(I,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(x,{name:"adminEmail",size:"small",required:!0,placeholder:"admin.company@domino.com...",InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ie,{})})},disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),e.jsx(x,{name:"adminPhone",type:"tel",size:"small",placeholder:"55 5555 5555",InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ae,{})})},disabled:n})]})]})]}),e.jsxs(t,{spacing:1,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Centros de Costos"}),e.jsx(z,{multiple:!0,name:"costCenters",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:c||[],disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Servicios"}),e.jsxs(t,{justifyContent:"space-between",flexDirection:"row",alignItems:"center",children:[e.jsx(de,{disabledEffect:!0,visibleByDefault:!0,alt:"logo",src:me,sx:{maxWidth:150,width:100,filter:(w==null?void 0:w.palette.mode)==="dark"?"brightness(0) invert(1) grayscale(100%)":"none"}}),e.jsx(ce,{disabled:n,size:"md",color:g.hasViaboCard?"success":"error",checked:!!g.hasViaboCard||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{S("hasViaboCard",!g.hasViaboCard)}})]})]}),e.jsxs(t,{spacing:2,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comisiones de salida"}),e.jsxs(t,{gap:3,children:[e.jsx(x,{name:"speiOut",placeholder:"0.0",label:"SPEI Out - Terceros",size:"small",type:"number",required:!0,disabled:n,InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(C,{position:"start",children:"%"})},inputProps:{inputMode:"numeric",min:A,max:d,step:P}}),e.jsx(x,{name:"internalTransferCompany",placeholder:"0.0",label:"Transferencia Interna - Empresas",size:"small",type:"number",required:!0,disabled:n,InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(C,{position:"start",children:"%"})},inputProps:{inputMode:"numeric",min:A,max:d,step:P}}),e.jsx(x,{name:"fee",placeholder:"0.0",size:"small",label:"Fee - STP",type:"number",required:!0,disabled:n,InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(C,{position:"start",children:"$"}),endAdornment:e.jsx(C,{position:"start",children:"MXN"})},inputProps:{inputMode:"numeric",min:A,max:v,step:P}})]})]}),e.jsxs(t,{spacing:2,children:[e.jsx(o,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comisiones de entrada"}),e.jsx(t,{gap:3,children:e.jsx(x,{name:"speiIn",placeholder:"0.0",label:"SPEI In - Externo",size:"small",type:"number",required:!0,disabled:n,InputLabelProps:{shrink:!0},InputProps:{endAdornment:e.jsx(C,{position:"start",children:"%"})},inputProps:{inputMode:"numeric",min:A,max:d,step:P}})})]}),e.jsx(t,{sx:{pt:1},children:e.jsx(te,{size:"large",loading:n,variant:"contained",color:"primary",fullWidth:!0,type:"submit",children:s?"Actualizar":"Crear"})})]})})};je.propTypes={adminCompanyUsers:a.array,commissions:a.shape({amount:a.number,percentage:a.number}),company:a.shape({adminUsers:a.array,commercialName:a.string,commissions:a.shape({fee:a.number,internalTransferCompany:a.number,speiIn:a.number,speiOut:a.number}),concentrator:a.shape({id:a.any}),costCenters:a.array,fiscalName:a.string,id:a.any,rfc:a.string}),concentrators:a.array,costCenters:a.array,onSuccess:a.func};export{je as default};
//# sourceMappingURL=SpeiNewCompanyForm-BNMaCjpG.js.map
