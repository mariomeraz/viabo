import{aH as S,f as R,c as B,U as w,r as W,dh as z,e as _,P as l,bD as H,bE as O,i as e,S as a,T as t,aj as C,aT as f,aV as $,bG as Q,bF as U,di as Y,dj as G,aC as N,z as I,Q as K,dk as X,B as j,bN as J,dl as Z,y,dm as D}from"./vendor-5lkxkETF.js";import{u as L}from"./formik.esm-CTTSENmf.js";import{C as k}from"./mui-tel-input.es-CLQYayqs.js";import{c as ee,a as g}from"./index.esm-gIIytEq8.js";import{K as re,r as oe,a as E,g as q,b as ne,a0 as A,P as ae,R as se}from"./index-DkbAsBWZ.js";import{f as ie}from"./formatNumber-dGNhWwxT.js";import{F as te,R as b,M as T,L as ce}from"./TextMaxLine-B63DtfW-.js";import{M as le}from"./MasterCardLogo-C26mw1FM.js";import{V as de}from"./VisaLogo-BXtVVQaT.js";import{V as ue}from"./viabo-pay-Tb0TUikx.js";import{P as xe}from"./PublicLayout-DsTMv5UW.js";import"./formatTime-jCgU2sMR.js";import"./matchTypes-mENztEWg.js";import"./UploadSingleFile-ByYCreVQ.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";const he=(r,o)=>{const n=r!=null&&r.expiration?S(new Date(r==null?void 0:r.expiration),"MM/yyyy"):null,c=n?n==null?void 0:n.slice(-2):"",i=n?n==null?void 0:n.slice(0,2):"",p=n?(n==null?void 0:n.slice(0,3))+c:"",h={payId:o==null?void 0:o.id,cardHolder:r==null?void 0:r.name,phone:r==null?void 0:r.phone,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expirationDate:p,expMonth:i,expYear:c,security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return re(h)},F={INFO:"payment-link-info"},me=r=>{const o=oe(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:ie(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName},reference:o==null?void 0:o.reference,terminalId:o==null?void 0:o.terminalId,transaction:{reference:(o==null?void 0:o.apiReferenceNumber)!==""?o==null?void 0:o.apiReferenceNumber:"-",authCode:(o==null?void 0:o.apiAuthCode)!==""?o==null?void 0:o.apiAuthCode:"-"}};throw new Error("Algo fallo al obtenerla información de la liga de pago")},pe=async r=>{const{data:o}=await E.get(`/api/commerces/pay/${r}`);return me(o)},ge=async r=>{const{data:o}=await E.post("/api/commerce/pay/generate/transaction",r);return o},je=(r,o={})=>{const n=R(ge,o),c=B();return{...n,mutate:async(p,h)=>{const{onSuccess:u,onError:x,mutationOptions:m}=h;try{await w.promise(n.mutateAsync(p,m),{pending:"Realizando cargo ...",success:{render({data:s}){return c.invalidateQueries([F.INFO]),u(s),"Se realizo el pago con éxito"}}})}catch(s){const d=q(s,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");x(d),w.error(d,{type:ne(s)})}}}},fe=(r,o={})=>{const[n,c]=W.useState(null),i=z();return{..._([F.INFO,r],()=>pe(r),{staleTime:6e4,onError:h=>{const u=q(h,"No se puede obtener la informacion de la liga de pago");c(u),i("/404")},...o}),error:n||null}},M=({details:r})=>{const{mutate:o}=je(r==null?void 0:r.id),n=ee().shape({cardNumber:g().transform((s,d)=>d.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),expiration:g().nullable().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(s){const d=new Date(s);return H(d)&&O(d,new Date)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El teléfono es muy corto",s=>!(s&&s.replace(/[\s+]/g,"").length<10)).required("El teléfono es requerido")}),c=L({initialValues:{cardNumber:"",expiration:null,cvv:"",name:"",email:(r==null?void 0:r.email)||"",phone:(r==null?void 0:r.phone)||""},enableReinitialize:!0,validationSchema:n,onSubmit:(s,{setSubmitting:d,setFieldTouched:v})=>{const P=he(s,r);o(P,{onSuccess:()=>{d(!1)},onError:()=>{d(!1),u("cvv","").then(()=>{v("cvv",!1,!1)}),u("expiration",null).then(()=>{v("expiration",!1,!1)})}})}}),{errors:i,touched:p,isSubmitting:h,setFieldValue:u,values:x}=c,m=h;return e.jsx(te,{formik:c,children:e.jsxs(a,{spacing:3,children:[e.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(t,{variant:"h6",children:"Forma de Pago"}),e.jsx(C,{sx:{px:1},children:e.jsx(le,{sx:{width:30,height:30}})}),e.jsx(C,{sx:{px:1},children:e.jsx(de,{sx:{width:30,height:30}})})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(b,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx($,{})}),inputComponent:T,inputProps:{mask:"0000 0000 0000 0000",value:x.cardNumber,onAccept:s=>{u("cardNumber",s)}}},disabled:m})]}),e.jsxs(a,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),e.jsx(Q,{disabled:m,views:["year","month"],name:"expiration",value:x!=null&&x.expiration?new Date(x.expiration):null,required:!0,onChange:s=>{u("expiration",s)},slotProps:{textField:{fullWidth:!0,error:!!i.expiration,required:!0,helperText:i.expiration?i.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(b,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(U,{})}),inputComponent:T,inputProps:{mask:"000",onAccept:s=>{u("cvv",s)},value:x.cvv}},disabled:m})]})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(b,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:m,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(Y,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(b,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:m,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(G,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),e.jsx(k,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:x.phone,disabled:m,required:!0,onChange:(s,d)=>{u("phone",s)},error:p.phone&&!!i.phone,helperText:p.phone&&i.phone})]}),e.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(N,{component:I,underline:"always",color:"info.main",to:A.policies,target:"_blank",children:"Términos y condiciones"}),"  &  ",e.jsx(N,{component:I,underline:"always",color:"info.main",to:A.privacy,target:"_blank",children:"Acuerdos de privacidad"}),"."]}),e.jsx(a,{children:e.jsx(K,{loading:h,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(X,{}),children:"Pagar"})})]})})};M.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const be=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ve=r=>{var o;return((o=be.find(n=>(n==null?void 0:n.id)===r))==null?void 0:o.color)??"info"},V=({details:r})=>{var o,n,c,i;return e.jsx(a,{children:e.jsxs(C,{sx:{width:1,p:3,position:"relative"},elevation:1,children:[e.jsx(j,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:e.jsx("img",{src:ue,alt:"viabo-logo"})}),e.jsxs(a,{alignItems:"center",justifyContent:"center",spacing:2,children:[e.jsx(ce,{variant:"ghost",color:ve((o=r==null?void 0:r.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(n=r==null?void 0:r.status)==null?void 0:n.name}),e.jsx(J,{color:"primary",sx:{width:40,height:40}}),e.jsxs(a,{alignItems:"center",justifyContent:"center",children:[e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(t,{variant:"h2",children:[" ",r==null?void 0:r.amount]}),e.jsx(t,{variant:"caption",children:"MXN"})]}),e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Z,{}),e.jsx(t,{variant:"subtitle1",textTransform:"capitalize",children:r==null?void 0:r.name})]})]}),e.jsx(t,{textAlign:"center",variant:"body2",children:r==null?void 0:r.description})]}),((c=r==null?void 0:r.status)==null?void 0:c.id)==="7"&&e.jsx(e.Fragment,{children:e.jsxs(a,{divider:e.jsx(y,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:1,alignItems:"center",justifyContent:"center",p:2,children:[e.jsx(j,{}),e.jsx(t,{variant:"subtitle1",color:"text.secondary",children:"Detalles de la Transacción"}),e.jsxs(a,{flex:1,width:1,spacing:1,children:[e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Terminal:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.terminalId})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Referencia:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.reference})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Autorización:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:(i=r==null?void 0:r.transaction)==null?void 0:i.authCode})]})]})]})})]})})};V.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,reference:l.any,status:l.shape({id:l.any,name:l.any}),terminalId:l.any,transaction:l.shape({authCode:l.any})})};const ze=()=>{var c,i;const{paymentId:r}=D(),{data:o,isLoading:n}=fe(r,{enabled:!!r});return e.jsx(xe,{children:e.jsx(ae,{title:"Cobro",meta:e.jsxs(e.Fragment,{children:[e.jsx("meta",{name:"description",content:"Liga de Pago para el servicio Viabo Pay"}),e.jsx("meta",{name:"keywords",content:"viabo pay, liga de pago, pago en linea,servició de pago,paypal,viabo card"}),e.jsx("meta",{property:"og:title",content:`Liga de Pago Generada de Viabo Pay de un monto de : ${o==null?void 0:o.amount}`}),e.jsx("meta",{property:"og:description",content:"Esta es la página sobre  el cobro mediante una liga de pago generada para el servició viabo pay"}),e.jsx("meta",{property:"og:image",content:"/landingPage/img/instagram-3.jpg"})]}),children:e.jsxs(a,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100dvH",children:[n&&e.jsx(se,{}),!n&&o&&e.jsxs(a,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,maxWidth:((c=o==null?void 0:o.status)==null?void 0:c.id)==="7"?400:"sm",children:[e.jsx(V,{details:o}),["6","8"].includes((i=o==null?void 0:o.status)==null?void 0:i.id)&&e.jsx(M,{details:o})]})]})})})};export{ze as default};
//# sourceMappingURL=ChargePaymentLink-CGoE4Qr5.js.map
