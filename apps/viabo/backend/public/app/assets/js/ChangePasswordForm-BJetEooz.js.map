{"version":3,"file":"ChangePasswordForm-BJetEooz.js","sources":["../../../../../frontend/src/app/authentication/adapters/changePasswordAdapter.js","../../../../../frontend/src/app/authentication/hooks/useChangePassword.js","../../../../../frontend/src/app/authentication/components/ChangePasswordForm.jsx"],"sourcesContent":["import { getCryptInfo } from '@/shared/utils'\r\n\r\nexport const ChangePasswordAdapter = data => {\r\n  const password = {\r\n    code: data?.authCode,\r\n    currentPassword: data?.currentPassword,\r\n    newPassword: data?.newPassword,\r\n    confirmationPassword: data?.verifyNewPassword\r\n  }\r\n  return getCryptInfo(password)\r\n}\r\n","import { useMutation } from '@tanstack/react-query'\r\nimport { toast } from 'react-toastify'\r\n\r\nimport { changePassword } from '../services'\r\n\r\nimport { getErrorAPI, getNotificationTypeByErrorCode } from '@/shared/interceptors'\r\nimport { isFunction } from '@/shared/utils'\r\n\r\nexport const useChangePassword = (options = {}) => {\r\n  const password = useMutation(changePassword, options)\r\n  const mutate = async (formData, options) => {\r\n    const { onSuccess, onError, mutationOptions } = options\r\n\r\n    try {\r\n      await toast.promise(password.mutateAsync(formData, mutationOptions), {\r\n        pending: 'Actualizando Contraseña ...',\r\n        success: {\r\n          render({ data }) {\r\n            isFunction(onSuccess) && onSuccess(data)\r\n\r\n            return 'Se actualizo la contraseña con éxito'\r\n          }\r\n        }\r\n      })\r\n    } catch (error) {\r\n      const errorFormatted = getErrorAPI(\r\n        error,\r\n        `No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas`\r\n      )\r\n      isFunction(onError) && onError(errorFormatted)\r\n      toast.error(errorFormatted, {\r\n        type: getNotificationTypeByErrorCode(error)\r\n      })\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...password,\r\n    mutate\r\n  }\r\n}\r\n","import PropTypes from 'prop-types'\r\n\r\nimport { Refresh } from '@mui/icons-material'\r\nimport { LoadingButton } from '@mui/lab'\r\nimport { Alert, AlertTitle, Box, Stack, Typography } from '@mui/material'\r\nimport { useFormik } from 'formik'\r\nimport { MuiOtpInput } from 'mui-one-time-password-input'\r\nimport * as Yup from 'yup'\r\n\r\nimport { ChangePasswordAdapter } from '../adapters'\r\nimport { useChangePassword } from '../hooks'\r\n\r\nimport { useSendValidationCode } from '@/app/business/shared/hooks'\r\nimport { IconButtonAnimate } from '@/shared/components/animate'\r\nimport { FormProvider, RFPasswordField } from '@/shared/components/form'\r\nimport { useUser } from '@/shared/hooks'\r\nimport { matchIsNumeric } from '@/shared/utils'\r\n\r\nconst ChangePasswordForm = ({ onSuccess }) => {\r\n  const user = useUser()\r\n\r\n  const { mutate, isLoading } = useChangePassword()\r\n  const { mutate: sendCode, isLoading: isSendingCode } = useSendValidationCode()\r\n\r\n  const ChangePasswordSchema = Yup.object().shape({\r\n    currentPassword: Yup.string().trim().required('La contraseña actual es requerida'),\r\n    newPassword: Yup.string()\r\n      .trim()\r\n      .required('La contraseña nueva es requerida')\r\n      .matches(\r\n        '^(?=(?:.*\\\\d))(?=.*[A-Z])(?=.*[a-z])(?=.*[_\\\\-.\\\\@])\\\\S{8,16}$',\r\n        'La contraseña debe contener al menos 8 caracteres, una mayúscula, una minúscula , un número y un carácter especial [ - _ . @]'\r\n      ),\r\n    verifyNewPassword: Yup.string()\r\n      .trim()\r\n      .oneOf([Yup.ref('newPassword'), null], 'Las contraseñas no coinciden')\r\n      .required('La confirmación de la contraseña es requerida'),\r\n    authCode: Yup.string().required('El código de autorización es requerido')\r\n  })\r\n\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      currentPassword: '',\r\n      newPassword: '',\r\n      verifyNewPassword: '',\r\n      authCode: ''\r\n    },\r\n    enableReinitialize: true,\r\n    validationSchema: ChangePasswordSchema,\r\n    onSubmit: (values, { setSubmitting, setFieldTouched }) => {\r\n      const data = ChangePasswordAdapter(values)\r\n      mutate(data, {\r\n        onSuccess: () => {\r\n          setSubmitting(false)\r\n          onSuccess()\r\n        },\r\n        onError: () => {\r\n          setSubmitting(false)\r\n        }\r\n      })\r\n    }\r\n  })\r\n\r\n  const { isSubmitting, setFieldValue, values, errors } = formik\r\n\r\n  const loading = isSubmitting || isLoading\r\n\r\n  const handleChange = newValue => {\r\n    setFieldValue('authCode', newValue)\r\n  }\r\n\r\n  const validateChar = value => matchIsNumeric(value)\r\n\r\n  return (\r\n    <FormProvider formik={formik}>\r\n      <Stack spacing={2} p={3}>\r\n        <Alert severity=\"info\">\r\n          <AlertTitle>Código de Autorización</AlertTitle>\r\n          Enviamos un correo electrónico a{' '}\r\n          {\r\n            <Box component={'span'} fontWeight={'bold'}>\r\n              {user?.email}{' '}\r\n            </Box>\r\n          }\r\n          con el código de autorización.\r\n        </Alert>\r\n        <Stack spacing={1}>\r\n          <Typography m={0} paragraph variant=\"overline\" sx={{ color: 'text.disabled' }}>\r\n            Contraseña Actual *\r\n          </Typography>\r\n\r\n          <RFPasswordField\r\n            size={'small'}\r\n            name={'currentPassword'}\r\n            disabled={loading}\r\n            required\r\n            placeholder={'********'}\r\n          />\r\n        </Stack>\r\n\r\n        <Stack spacing={1}>\r\n          <Typography m={0} paragraph variant=\"overline\" sx={{ color: 'text.disabled' }}>\r\n            Contraseña Nueva *\r\n          </Typography>\r\n\r\n          <RFPasswordField size={'small'} name={'newPassword'} placeholder={'********'} disabled={loading} required />\r\n        </Stack>\r\n\r\n        <Stack spacing={1}>\r\n          <Typography m={0} paragraph variant=\"overline\" sx={{ color: 'text.disabled' }}>\r\n            Repetir Contraseña Nueva *\r\n          </Typography>\r\n\r\n          <RFPasswordField\r\n            size={'small'}\r\n            placeholder={'********'}\r\n            name={'verifyNewPassword'}\r\n            disabled={loading}\r\n            required\r\n          />\r\n        </Stack>\r\n\r\n        <Stack spacing={1}>\r\n          <Stack direction={'row'} justifyContent={'space-between'} alignItems={'center'}>\r\n            <Typography m={0} paragraph variant=\"overline\" sx={{ color: 'text.disabled' }}>\r\n              Código de Autorización *\r\n            </Typography>\r\n            <IconButtonAnimate\r\n              size=\"small\"\r\n              onClick={sendCode}\r\n              color=\"info\"\r\n              disabled={isSendingCode}\r\n              aria-haspopup=\"true\"\r\n              title=\"Reenviar\"\r\n            >\r\n              <Refresh width={20} height={20} />\r\n            </IconButtonAnimate>\r\n          </Stack>\r\n\r\n          <Stack>\r\n            <MuiOtpInput\r\n              length={6}\r\n              value={values.authCode}\r\n              onChange={handleChange}\r\n              validateChar={validateChar}\r\n              sx={{ gap: { xs: 1.5, sm: 2, md: 3 } }}\r\n              TextFieldsProps={{ placeholder: '-', error: !!errors.authCode, disabled: loading, size: 'small' }}\r\n            />\r\n            {Boolean(errors.authCode) && (\r\n              <Box mt={1}>\r\n                <Typography variant={'caption'} color={'error'}>\r\n                  {errors.authCode}\r\n                </Typography>\r\n              </Box>\r\n            )}\r\n          </Stack>\r\n        </Stack>\r\n\r\n        <Stack pt={2}>\r\n          <LoadingButton\r\n            loading={loading}\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            fullWidth\r\n            type=\"submit\"\r\n            sx={{ fontWeight: 'bold' }}\r\n          >\r\n            Guardar\r\n          </LoadingButton>\r\n        </Stack>\r\n      </Stack>\r\n    </FormProvider>\r\n  )\r\n}\r\n\r\nChangePasswordForm.propTypes = {\r\n  onSuccess: PropTypes.func\r\n}\r\n\r\nexport default ChangePasswordForm\r\n"],"names":["ChangePasswordAdapter","data","password","getCryptInfo","useChangePassword","options","useMutation","changePassword","formData","onSuccess","onError","mutationOptions","toast","isFunction","error","errorFormatted","getErrorAPI","getNotificationTypeByErrorCode","ChangePasswordForm","user","useUser","mutate","isLoading","sendCode","isSendingCode","useSendValidationCode","ChangePasswordSchema","Yup","shape","currentPassword","trim","required","newPassword","matches","verifyNewPassword","oneOf","authCode","formik","useFormik","initialValues","enableReinitialize","validationSchema","onSubmit","values","setSubmitting","setFieldTouched","isSubmitting","setFieldValue","errors","loading","handleChange","newValue","validateChar","matchIsNumeric","value","jsx","FormProvider","jsxs","Stack","Alert","AlertTitle","Box","email","Typography","color","RFPasswordField","IconButtonAnimate","Refresh","MuiOtpInput","gap","xs","sm","md","placeholder","disabled","size","Boolean","LoadingButton","fontWeight","propTypes","PropTypes","func"],"mappings":"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"}