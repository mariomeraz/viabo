{"version":3,"file":"TwoAuthForm-B7_MQieV.js","sources":["../../../../../frontend/src/app/authentication/components/TwoAuthForm.jsx"],"sourcesContent":["import { useState } from 'react'\r\n\r\nimport PropTypes from 'prop-types'\r\n\r\nimport { CheckCircle, HdrStrongTwoTone } from '@mui/icons-material'\r\nimport {\r\n  Button,\r\n  CircularProgress,\r\n  Link,\r\n  List,\r\n  ListItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  Stack,\r\n  Typography\r\n} from '@mui/material'\r\nimport { format } from 'date-fns'\r\nimport { es } from 'date-fns/locale'\r\nimport { MuiOtpInput } from 'mui-one-time-password-input'\r\n\r\nimport { Image } from '@/shared/components/images'\r\nimport { Scrollbar } from '@/shared/components/scroll'\r\nimport { matchIsNumeric, setSession } from '@/shared/utils'\r\n\r\nconst TwoAuthForm = ({ onFinish, mutateTwoAuth, googleCode }) => {\r\n  const { mutate, isLoading, isSuccess } = mutateTwoAuth\r\n\r\n  const [otp, setOtp] = useState('')\r\n\r\n  const handleChange = newValue => {\r\n    setOtp(newValue)\r\n  }\r\n\r\n  const validateChar = value => matchIsNumeric(value)\r\n\r\n  const handleComplete = value => {\r\n    setOtp('')\r\n    mutate(\r\n      { code: value, secret: googleCode?.key },\r\n      {\r\n        onSuccess: data => {\r\n          if (data?.token) {\r\n            setSession(data?.token)\r\n          }\r\n        },\r\n        onError: () => {\r\n          setOtp('')\r\n        }\r\n      }\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Scrollbar containerProps={{ sx: { flexGrow: 0, height: 'auto' } }}>\r\n      <Stack gap={2} p={3} pb={6}>\r\n        {isSuccess && <SuccessTwoAuth onFinish={onFinish} />}\r\n        {!isSuccess && (\r\n          <>\r\n            <Stack>\r\n              <List dense={false}>\r\n                <ListItem sx={{ px: 0 }}>\r\n                  <ListItemIcon>\r\n                    <HdrStrongTwoTone />\r\n                  </ListItemIcon>\r\n                  <ListItemText\r\n                    primary={\r\n                      <Typography variant=\"body2\" fontWeight={600} sx={{ color: 'text.secondary', textWrap: 'wrap' }}>\r\n                        Descarga la aplicación Google Authenticator en tu teléfono &nbsp;\r\n                        <Link\r\n                          color=\"primary\"\r\n                          rel=\"noreferrer\"\r\n                          target=\"_blank\"\r\n                          href={\r\n                            'https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&pcampaignid=web_share'\r\n                          }\r\n                          sx={{ cursor: 'pointer' }}\r\n                        >\r\n                          Android\r\n                        </Link>\r\n                        &nbsp; ó &nbsp;\r\n                        <Link\r\n                          color=\"primary\"\r\n                          rel=\"noreferrer\"\r\n                          target=\"_blank\"\r\n                          href={'https://apps.apple.com/es/app/google-authenticator/id388497605'}\r\n                          sx={{ cursor: 'pointer' }}\r\n                        >\r\n                          IOS\r\n                        </Link>\r\n                      </Typography>\r\n                    }\r\n                  />\r\n                </ListItem>\r\n                <ListItem sx={{ px: 0 }}>\r\n                  <ListItemIcon>\r\n                    <HdrStrongTwoTone />\r\n                  </ListItemIcon>\r\n                  <ListItemText\r\n                    primary={\r\n                      <Typography variant=\"body2\" fontWeight={600} sx={{ color: 'text.secondary', textWrap: 'wrap' }}>\r\n                        En la Aplicación configura tu cuenta\r\n                      </Typography>\r\n                    }\r\n                  />\r\n                </ListItem>\r\n                <ListItem sx={{ px: 0 }}>\r\n                  <ListItemIcon>\r\n                    <HdrStrongTwoTone />\r\n                  </ListItemIcon>\r\n                  <ListItemText\r\n                    primary={\r\n                      <Typography variant=\"body2\" fontWeight={600} sx={{ color: 'text.secondary', textWrap: 'wrap' }}>\r\n                        Elige la opción de escanear un código QR\r\n                      </Typography>\r\n                    }\r\n                  />\r\n                </ListItem>\r\n\r\n                <ListItem sx={{ px: 0 }}>\r\n                  <ListItemIcon>\r\n                    <HdrStrongTwoTone />\r\n                  </ListItemIcon>\r\n                  <ListItemText\r\n                    primary={\r\n                      <Typography variant=\"body2\" fontWeight={600} sx={{ color: 'text.secondary', textWrap: 'wrap' }}>\r\n                        Escanea el siguiente QR e ingresa el código\r\n                      </Typography>\r\n                    }\r\n                  />\r\n                </ListItem>\r\n              </List>\r\n            </Stack>\r\n            {isLoading ? (\r\n              <Stack spacing={1} justifyContent={'center'} alignItems={'center'}>\r\n                <CircularProgress />\r\n                <Typography variant=\"body2\" fontWeight={600} sx={{ color: 'text.primary', textWrap: 'wrap' }}>\r\n                  Configurando dispositivo...\r\n                </Typography>\r\n                <Typography variant=\"body2\" sx={{ color: 'text.disabled', textWrap: 'wrap' }}>\r\n                  No cierres la ventana hasta que se complete la configuración\r\n                </Typography>\r\n              </Stack>\r\n            ) : (\r\n              <>\r\n                <Stack justifyContent={'center'} alignItems={'center'}>\r\n                  <Image src={googleCode?.qr} sx={{ width: 150, m: 0, p: 0 }} />\r\n                </Stack>\r\n                <MuiOtpInput\r\n                  length={6}\r\n                  value={otp}\r\n                  onComplete={handleComplete}\r\n                  onChange={handleChange}\r\n                  validateChar={validateChar}\r\n                  sx={{ gap: { xs: 1.5, sm: 2, md: 3 } }}\r\n                  TextFieldsProps={{ placeholder: '0' }}\r\n                />\r\n              </>\r\n            )}\r\n          </>\r\n        )}\r\n      </Stack>\r\n    </Scrollbar>\r\n  )\r\n}\r\n\r\nTwoAuthForm.propTypes = {\r\n  googleCode: PropTypes.shape({\r\n    key: PropTypes.any,\r\n    qr: PropTypes.any\r\n  }),\r\n  mutateTwoAuth: PropTypes.shape({\r\n    isLoading: PropTypes.any,\r\n    isSuccess: PropTypes.any,\r\n    mutate: PropTypes.func\r\n  }),\r\n  onFinish: PropTypes.any\r\n}\r\n\r\nexport default TwoAuthForm\r\n\r\nfunction SuccessTwoAuth({ onFinish }) {\r\n  return (\r\n    <Stack flexDirection=\"column\" alignItems={'center'} spacing={2} mt={3}>\r\n      <CheckCircle sx={{ width: 50, height: 50 }} color={'success'} />\r\n      <Stack alignItems={'center'} spacing={1}>\r\n        <Typography variant=\"h6\">{`Configuración Exitosa`}</Typography>\r\n        <Typography variant=\"caption\" color={'text.disabled'}>\r\n          {format(new Date(), 'dd MMM yyyy hh:mm a', { locale: es })}\r\n        </Typography>\r\n      </Stack>\r\n      <Stack sx={{ px: 9, pt: 3 }}>\r\n        <Button type=\"button\" size=\"large\" variant=\"contained\" sx={{ fontWeight: 'bold' }} onClick={onFinish}>\r\n          Finalizar\r\n        </Button>\r\n      </Stack>\r\n    </Stack>\r\n  )\r\n}\r\n\r\nSuccessTwoAuth.propTypes = {\r\n  onFinish: PropTypes.any\r\n}\r\n"],"names":["TwoAuthForm","onFinish","mutateTwoAuth","googleCode","mutate","isLoading","isSuccess","otp","setOtp","useState","handleChange","newValue","validateChar","matchIsNumeric","value","handleComplete","code","secret","key","onSuccess","data","token","setSession","onError","jsx","Scrollbar","sx","flexGrow","height","Stack","SuccessTwoAuth","jsxs","Fragment","List","ListItem","px","ListItemIcon","HdrStrongTwoTone","ListItemText","Typography","color","textWrap","Link","cursor","CircularProgress","Image","qr","width","m","p","MuiOtpInput","gap","xs","sm","md","placeholder","propTypes","PropTypes","shape","any","func","CheckCircle","format","Date","locale","es","pt","Button","fontWeight"],"mappings":"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"}